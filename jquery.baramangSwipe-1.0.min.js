/*!
 * BaramangSwipe jQuery Plugin v1.0
 * http://lab.zzune.com
 * https://github.com/rioald/BaramangSwipe
 *
 * Baramang(Banana, Lime, Mango) is originate by jjaom
 * special thanks to gramakson, hyo
 *
 * Copyright (c) 2011 zune-seok Moon (zune rioald).
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * 
 * Depends on TouchSwipe (jquery.touchSwipe v1.2.5)
 * Matt Bryson (www.skinkers.com)
 * http://plugins.jquery.com/project/touchSwipe
 * http://labs.skinkers.com/touchSwipe/
 * https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
 *
 * Date: Wed Dec 28 11:38:36 2011 +0900
 */
var BaramangSwipe={template:{},action:{}};(function(a){BaramangSwipe.model=function(b,c,d){var e=this;this.obj=b;this.elementsSelector=c;this.elements=this.obj.find(this.elementsSelector);this.lock=false;this.containerX=0;this.elementWidth=d.elementWidth||this.elements.eq(0).width();this.elementCount=this.elements.length;this.elementCountPerGroup=d.elementCountPerGroup||999;this.maxElementGroup=d.elementCountPerGroup?Math.ceil(this.elementCount/d.elementCountPerGroup):this.elementCount;this.currentPositionGroup=d.currentPositionGroup||0;this.currentPageNo=0;var f=d.isLoop||false;var g=false;var h=null;this.options={elementWidth:d.elementWidth||this.elements.eq(0).width(),elementCountPerGroup:d.elementCountPerGroup||999,speed:d.speed||500,isLoop:d.isLoop||false,isAutoScroll:d.isAutoScroll||false,autoScrollDirection:d.autoScrollDirection=="left"?"left":"right",autoScrollTime:d.autoScrollTime||9e3};this.swipeOptions=a.extend({triggerOnTouchEnd:true,swipeStatus:function(a,b,c,d){e.swipeStatus(a,b,c,d)},allowPageScroll:"vertical",threshold:navigator.userAgent.search("Android")>-1?15:75,click:function(b,c){var d=a(c).parents("a");if(d.length>0){var e=d.get(0).onclick?d.get(0).onclick():true;if(e){window.location.href=d.eq(0).attr("href")}}}},d.swipeOptions);this._initDimension=function(){var b=e.obj.parent().width();e.elementWidth=Math.min(e.options.elementWidth,b);e.obj.width(e.elementWidth*e.elementCount);var c=Math.floor(b/e.elementWidth);if(e.options.elementCountPerGroup>c){e.elementCountPerGroup=c}else{e.elementCountPerGroup=e.options.elementCountPerGroup}e.maxElementGroup=Math.ceil(e.elementCount/e.elementCountPerGroup);e.elementWidth=Math.ceil(b/Math.min(e.elementCountPerGroup,e.elementCount));e.elements.width(e.elementWidth);if(e.maxElementGroup<=1&&e.options.isLoop){f=false}else{f=e.options.isLoop}a.each(e.elements,function(b,c){a(c).attr("elementindex",a(c).attr("elementindex")||b).attr("elementposition",e.containerX+e.elementWidth*b).css({position:"absolute",left:e.containerX+e.elementWidth*b,"-webkit-transform":"translateZ(0px)"}).show()});e._initHeight&&e._initHeight();e.obj.height(e.elements.eq(0).outerHeight())};this._initHeight=function(){var a=e.obj.parent().find("img");if(a.length>0){a.bind("load",function(){var a=e.elements.outerHeight();if(e.obj.height()<=a){e.obj.height(a)}})}e._initHeight=null};this._initShadow=function(){var b=e.elements.parent();var c=a(e.elements.slice(-e.elementCountPerGroup).clone().get().reverse());a.each(c,function(b,c){a(c).attr("elementposition",e.containerX+ -e.elementWidth-e.elementWidth*b).css({left:e.containerX+ -e.elementWidth-e.elementWidth*b})});b.prepend(c.get().reverse());if(e.elementCount%e.elementCountPerGroup!=0){var d=e.elements.slice(0,e.elementCountPerGroup+e.elementCount%e.elementCountPerGroup).clone();a.each(d,function(b,c){a(c).attr("elementposition",e.containerX+e.elementWidth*e.elementCount+e.elementWidth*b).css({left:e.containerX+e.elementWidth*e.elementCount+e.elementWidth*b})});b.append(d)}e.elements=e.obj.find(e.elementsSelector)};this._init=function(){e._initDimension();if(e.maxElementGroup>1&&f){e._initShadow()}if(e.options.isAutoScroll){e.activateAutoScroll()}};this.load=function(a){e._init();e.scrollElements=e.scrollElementsByTranslate;e.obj.swipe(e.swipeOptions);if(a&&a instanceof Function){a(e)}return e};this.reload=function(){if(f){e.elements.not(e.elements.slice(e.elementCountPerGroup,e.elementCountPerGroup+e.elementCount)).remove();var b=parseInt(e.elements.eq(0).css("left"));a.each(e.elements,function(c,d){a(d).attr("elementposition",b+e.elementWidth*c).css({left:b+e.elementWidth*c})});e.elements=e.obj.find(e.elementsSelector);setTimeout(function(){e._init();if(e.maxElementGroup<=1){e.scrollElements(e.containerX=parseInt(e.elements.eq(0).css("left")),0);e.currentPageNo=0}else{e.scrollElements(e.containerX=parseInt(e.elements.eq(e.elementCountPerGroup).css("left")),0)}},0)}else{var b=parseInt(e.elements.eq(0).css("left"));a.each(e.elements,function(c,d){a(d).attr("elementposition",b+e.elementWidth*c).css({left:b+e.elementWidth*c})});e.elements=e.obj.find(e.elementsSelector);setTimeout(function(){e._init();if(e.maxElementGroup<=1){e.scrollElements(e.containerX=parseInt(e.elements.eq(0).css("left")),0);e.currentPageNo=0}else{e.scrollElements(e.containerX=parseInt(e.elements.eq(e.elementCountPerGroup).css("left")),0)}},0)}};this.success=function(){};this.contextMenuEventHandler=function(a){return false};this.swipeStatus=function(a,b,c,d){e.swipeStatusByTranslate(a,b,c,d);e.scrollElements=e.scrollElementsByTranslate;if(b=="end"){e.obj.get(0).oncontextmenu=e.contextMenuEventHandler}else{e.obj.get(0).oncontextmenu=null}};this.swipeStatusByTranslate=function(a,b,c,d){var f=e.containerX;if(b=="move"&&(c=="up"||c=="down")){e.lock=true;if(d>0){e.scrollElements(f,e.options.speed)}return}else if(e.lock&&(b=="cancel"||b=="end")){e.lock=false;return}else if(e.lock){return}else if(b=="move"&&(c=="left"||c=="right")){if(e.options.isAutoScroll){e.deactivateAutoScroll()}var g=0;if(c=="left"){e.scrollElements(f+d,g)}else if(c=="right"){e.scrollElements(f-d,g)}}else if(b=="cancel"){e.scrollElements(f,e.options.speed);if(e.options.isAutoScroll){e.activateAutoScroll()}}else if(b=="end"){if(c=="right"){e.previousElement()}else if(c=="left"){e.nextElement()}if(e.options.isAutoScroll){e.activateAutoScroll()}}};this.previousElement=function(b,c,d){b=b||1;c=c||true;d=d||e.options.speed;if(f){e.currentPositionGroup-=b;e.currentPageNo=e.currentPageNo-b;if(e.currentPageNo<=-1){e.currentPageNo=e.maxElementGroup+e.currentPageNo}else if(e.currentPageNo>=e.maxElementGroup){e.currentPageNo=e.currentPageNo-e.maxElementGroup}var g=e.containerX=e.containerX-e.elementWidth*e.elementCountPerGroup*b;e.scrollElements(g,d);var h=parseInt(e.elements.eq(0).css("left"));var i=parseInt(e.elements.eq(0).attr("elementindex"))-e.elementCountPerGroup;if(i<0){i=e.elementCount+i}var j=e.elements.slice(-e.elementCount);var k=0;j.each(function(b,c){if(a(c).attr("elementindex")==i){k=b;return}});var l=j.slice(k,k+e.elementCountPerGroup).clone();if(l.length<e.elementCountPerGroup){l=l.add(j.slice(0,e.elementCountPerGroup-l.length).clone())}setTimeout(function(){a.each(l,function(b,c){a(c).attr("elementposition",h+ -e.elementWidth-e.elementWidth*(l.length-1-b)).css({left:h+ -e.elementWidth-e.elementWidth*(l.length-1-b)})});e.elements.parent().prepend(l);e.elements.slice(-e.elementCountPerGroup).remove();e.elements=e.obj.find(e.elementsSelector)},0)}else{if(e.currentPageNo<=0){e.scrollElements(e.containerX,d)}else{e.currentPositionGroup=Math.max(e.currentPositionGroup-b,0);e.currentPageNo=Math.max(e.currentPageNo-b,0);var g=e.containerX=e.containerX-e.elementWidth*e.elementCountPerGroup*b;e.scrollElements(g,d)}}if(c){setTimeout(e.success,0)}};this.nextElement=function(b,c,d){b=b||1;c=c||true;d=d||e.options.speed;if(f){e.currentPositionGroup+=b;e.currentPageNo=e.currentPageNo+b;if(e.currentPageNo<=-1){e.currentPageNo=e.maxElementGroup+e.currentPageNo}else if(e.currentPageNo>=e.maxElementGroup){e.currentPageNo=e.currentPageNo-e.maxElementGroup}var g=e.containerX=e.containerX+e.elementWidth*e.elementCountPerGroup*b;e.scrollElements(g,d);var h=parseInt(e.elements.eq(-1).css("left"));var i=parseInt(e.elements.eq(-1).attr("elementindex"))+1;if(i>=e.elementCount){i=i-e.elementCount}var j=e.elements.slice(0,e.elementCount);var k=0;j.each(function(b,c){if(a(c).attr("elementindex")==i){k=b;return}});var l=j.slice(k,k+e.elementCountPerGroup).clone();if(l.length<e.elementCountPerGroup){l=l.add(j.slice(0,e.elementCountPerGroup-l.length).clone())}setTimeout(function(){a.each(l,function(b,c){a(c).attr("elementposition",h+e.elementWidth*(b+1)).css({left:h+e.elementWidth*(b+1)})});e.elements.parent().append(l);e.elements.slice(0,e.elementCountPerGroup).remove();e.elements=e.obj.find(e.elementsSelector)},0)}else{if(e.currentPageNo>=e.maxElementGroup-1){e.scrollElements(e.containerX,d)}else{e.currentPositionGroup=Math.min(e.currentPageNo+1,e.maxElementGroup-1);e.currentPageNo=Math.min(e.currentPageNo+1,e.maxElementGroup-1);var g=e.containerX=e.containerX+e.elementWidth*e.elementCountPerGroup*b;e.scrollElements(g,d)}}if(c){setTimeout(e.success,0)}};this.moveTo=function(a,b,c){var d=0;if(a>e.currentPageNo){d=Math.min(a-e.currentPageNo,e.maxElementGroup-1-e.currentPageNo);if(d>0){var f=e.elements.slice(e.elementCountPerGroup).filter("[elementindex="+e.currentPageNo*e.elementCountPerGroup+"]").index();var g=Math.ceil(e.elements.slice(0,f).length/e.elementCountPerGroup)-1;var h=Math.ceil(e.elements.slice(f).length/e.elementCountPerGroup)-1;if(d>h){e.previousElement(e.maxElementGroup-d,b,c)}else{e.nextElement(d,b,c)}}}else if(a<e.currentPageNo){d=Math.min(e.currentPageNo-a,e.currentPageNo);if(d>0){var f=e.elements.slice(e.elementCountPerGroup).filter("[elementindex="+e.currentPageNo*e.elementCountPerGroup+"]").index();var g=Math.ceil(e.elements.slice(0,f).length/e.elementCountPerGroup)-1;var h=Math.ceil(e.elements.slice(f).length/e.elementCountPerGroup)-1;if(d>g){e.nextElement(e.maxElementGroup-d,b,c)}else{e.previousElement(d,b,c)}}}};this.getCurrentElements=function(){var a=e.elements.filter("[elementposition='"+e.getCurrentElementPosition()+"']").index();var b=Math.floor(a/e.elementCountPerGroup);return e.elements.slice(b*e.elementCountPerGroup,(b+1)*e.elementCountPerGroup)};this.getCurrentElementPosition=function(){return e.obj.attr("elementposition")||0};this.activateAutoScroll=function(){if(e.maxElementGroup==1){if(h){clearInterval(h)}return}if(h){clearInterval(h)}if(e.options.autoScrollDirection=="left"){if(!f&&e.currentPageNo==0){e.options.autoScrollDirection="right";e.activateAutoScroll();return}h=setInterval(function(){e.previousElement();e.activateAutoScroll()},e.options.autoScrollTime)}else{if(!f&&e.currentPageNo==e.maxElementGroup-1){e.options.autoScrollDirection="left";e.activateAutoScroll();return}h=setInterval(function(){e.nextElement();e.activateAutoScroll()},e.options.autoScrollTime)}};this.deactivateAutoScroll=function(){if(h){clearInterval(h)}};this.onresize=function(){if(e.currentWindowSize!=a(window).width()){e.currentWindowSize=a(window).width();e.reload()}};if(navigator.userAgent.search("iPhone|iPod|iPad")>-1){a(window).bind("orientationchange",e.onresize)}else{a(window).bind("resize",e.onresize)}this.scrollElements=function(){};this.scrollElementsByTranslate=function(a,b){e.obj.css("-webkit-transition-duration",(b/1e3).toFixed(1)+"s");a=a||0;var c=(a<0?"":"-")+Math.abs(a).toString();e.obj.attr("elementposition",-c);e.obj.css("-webkit-transform","translate3d("+c+"px, 0px, 0px)")};BaramangSwipe.action[this.obj.attr("id")||(new Date).getMilliseconds()]=this};a.fn.baramangSwipe=function(b,c){this.baramangSwipe=new BaramangSwipe.model(a(this),b,c);return this.baramangSwipe}})(jQuery)